# Talend Daikon - Crypto utils

## Description

This module contains helper for encryption and decryption of data.

## Build

To build module, simply run `mvn install`

```bash
$> mvn install
```

## Usage

This library offers utilities for both digest and encryption.

## Digest

```java
public static void main(String[] args) throws Exception {
    byte[] salt = KeySources.random(16).getKey();
    Digester digester = new Digester(DigestSources.pbkDf2(salt));

    final String digest = digester.digest("tiger");
    System.out.println("digest = " + digest);

    System.out.println("Validate 'tiger': " + digester.validate("tiger", digest));
    System.out.println("Validate 'password': " + digester.validate("password", digest));
}
```

The code above produces this example (the randomized KeySource at the beginning make digest change at each execution).

```text
digest = j ���]��>e��e�B0����}"����76�-+��hnn���N��<�Ԡ.KkZ�\����ݍG
Validate 'tiger': true
Validate 'password': false
```

### Encryption

The main entry point for this module is the class `Encryption`. It needs as input:

* A `KeySource`: the key that will be used to initialize the encryption algorithm. This is a critical piece of configuration: it cannot be a constant but it must be a value application must be able to find again (in case of an application restart, for example).
* A `CipherSource`: the type of algorithm you want to use for encryption and decryption.

Both `KeySource` and `CipherSource` have helpers to ease integration in your code. A quick example looks like this:

```java
public static void main(String[] args) throws Exception {
    final KeySource keySource = KeySources.machineUID(16); // (1)
    final CipherSource cipherSource = CipherSources.getDefault(); // (2) 
    final Encryption encryption = new Encryption(keySource, cipherSource);

    final String encrypt1 = encryption.encrypt("MyUnsecureString");
    final String encrypt2 = encryption.encrypt("MyUnsecureString");

    System.out.println("encrypt (1) = " + encrypt1);
    System.out.println("encrypt (2) = " + encrypt2);

    System.out.println("decrypt (1) = " + encryption.decrypt(encrypt1));
    System.out.println("decrypt (2) = " + encryption.decrypt(encrypt2));
}
```

A quick explanation: 
* (1) a generated key of 16 bytes will be created using the MAC addresses of the network interfaces on the machine that runs the code.
* (2) a AES/GCM encryption algorithm with a random IV of 16 bytes. It means each value will be encrypted using an additional random value (in addition of the key generated by (1)).

Running this example may create the following output:

```text
encrypt (1) = LPX1zmpCZFyS3a2rDkqnJr+nM3tTOav4kABKBhvTT9alPbAxuPrOywLP5eEDFnin
encrypt (2) = +0t6DcPTYfbZLHNQWF6z6cv3QtUH9EBDAlVyAtGrOokUHl8cZMJ1SNaCa8dNZQtp
decrypt (1) = MyUnsecureString
decrypt (2) = MyUnsecureString
```

### Available CipherSource

The `CipherSources::aes()` gives a standard AES encryption support (with *random* value). Encryption of the same value will always produce the same result.
The usage of `CipherSources::getDefault()` is strongly recommended.

### Available KeySource

* `KeySources::machineUID`: generate key out of network interfaces MAC address.
* `KeySources::systemProperty`: retrieve key value from a system property.
* `KeySources::fixedKey`: use provided value as key. This one is only here to ease migration to a more secure key generation and use of it is discouraged.

## Support

You can ask for help on our [forum](https://community.talend.com/).


## Contributing

We welcome contributions of all kinds from anyone.

Using the [Talend bugtracker](https://jira.talendforge.org/projects/TDKN) is the best channel for bug reports and feature requests. Use [GitHub](https://github.com/Talend/daikon) to submit pull requests.

For code formatting, please use the configuration file and setup for Eclipse or IntelliJ that you find here: https://github.com/Talend/tools/tree/master/tools-java-formatter


## License

Copyright (c) 2006-2019 Talend

Licensed under the [Apache Licence v2](https://www.apache.org/licenses/LICENSE-2.0.txt)